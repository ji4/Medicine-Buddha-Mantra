<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>藥師咒羅馬拼音對照表</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>
    <!-- 現代化播放器控制列 -->
    <div class="video-controls" id="videoControls">
        <!-- 手機版左側區域 -->
        <div class="mobile-left">
            <button class="control-btn" onclick="resetAndPlay()" title="重新播放">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"></path>
                </svg>
            </button>
            <div class="current-time" id="currentTime">00:00</div>
        </div>
        
        <!-- 手機版中央區域 -->
        <div class="mobile-center">
            <button class="control-btn" onclick="seekRelative(-2)" title="後退 2 秒">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"></path>
                </svg>
            </button>
            <button class="control-btn play-pause-btn" id="playPauseBtn" onclick="togglePlayPause()" title="播放/暫停">
                <svg id="playIcon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" style="display: block;">
                    <path d="M8 5v14l11-7z"></path>
                </svg>
                <svg id="pauseIcon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                    <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path>
                </svg>
            </button>
            <button class="control-btn" onclick="seekRelative(2)" title="前進 2 秒">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16 18h2V6h-2zm-3.5-6L4 6v12z"></path>
                </svg>
            </button>
        </div>
        
        <!-- 手機版右側區域 -->
        <div class="mobile-right">
            <select class="speed-select" id="speedSelect" onchange="changePlaybackRate()" title="播放速度">
                <option value="0.25">0.25×</option>
                <option value="0.5">0.5×</option>
                <option value="0.75">0.75×</option>
                <option value="1" selected>1×</option>
                <option value="1.25">1.25×</option>
                <option value="1.5">1.5×</option>
                <option value="1.75">1.75×</option>
                <option value="2">2×</option>
            </select>
        </div>
        
        <!-- 桌機版元素（手機版下隱藏） -->
        <!-- 重新播放 -->
        <div>
            <button class="control-btn" onclick="resetAndPlay()" title="重新播放">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"></path>
                </svg>
            </button>
            <div class="helper-text">R 鍵</div>
        </div>
        
        <!-- 時間顯示 -->
        <div class="current-time" id="currentTimeDesktop">00:00</div>
        
        <!-- 後退 -->
        <div>
            <button class="control-btn" onclick="seekRelative(-2)" title="後退 2 秒">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"></path>
                </svg>
            </button>
            <div class="helper-text">← 或 [</div>
        </div>
        
        <!-- 播放/暫停 -->
        <div>
            <button class="control-btn play-pause-btn" id="playPauseBtnDesktop" onclick="togglePlayPause()" title="播放/暫停">
                <svg id="playIconDesktop" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" style="display: block;">
                    <path d="M8 5v14l11-7z"></path>
                </svg>
                <svg id="pauseIconDesktop" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                    <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path>
                </svg>
            </button>
            <div class="helper-text">空白鍵</div>
        </div>
        
        <!-- 前進 -->
        <div>
            <button class="control-btn" onclick="seekRelative(2)" title="前進 2 秒">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16 18h2V6h-2zm-3.5-6L4 6v12z"></path>
                </svg>
            </button>
            <div class="helper-text">→ 或 ]</div>
        </div>
        
        <!-- 速度控制 -->
        <div>
            <select class="speed-select" id="speedSelectDesktop" onchange="changePlaybackRate()" title="播放速度">
                <option value="0.25">0.25×</option>
                <option value="0.5">0.5×</option>
                <option value="0.75">0.75×</option>
                <option value="1" selected>1×</option>
                <option value="1.25">1.25×</option>
                <option value="1.5">1.5×</option>
                <option value="1.75">1.75×</option>
                <option value="2">2×</option>
            </select>
            <div class="helper-text">- + 鍵</div>
        </div>
    </div>
    
    <div class="container">
        <div class="title">《藥師咒》梵漢對照全文</div>
        
        <div class="main-content vertical-mode" id="mainContent">
            <!-- 左側：影片區域 -->
            <div class="left-section">
                <div class="video-section">
                    <div class="section-title">
                        梵字拼音對照
                    </div>
                    
                    <div class="video-container">
                        <iframe id="youtubePlayer" 
                                frameborder="0" 
                                allowfullscreen 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                                referrerpolicy="strict-origin-when-cross-origin" 
                                title="108篇藥師咒、藥師灌頂真言 (梵音)" 
                                width="100%" 
                                height="100%" 
                                src="https://www.youtube.com/embed/oayy63pHCAA?enablejsapi=1&rel=0&modestbranding=1&controls=0&disablekb=1&playsinline=1&iv_load_policy=3&fs=0">
                        </iframe>
                    </div>
                </div>
            </div>
            
            <!-- 右側：梵字全文 -->
            <div class="right-section">
                <div class="mantra-content">
                    
                    <div class="mantra-section">
                        <div class="word-group">
                            <div class="romanization"><span class="voiced">na</span> - <span class="voiced">mo</span></div>
                            <div class="chinese">禮敬</div>
                        </div>
                        
                        <div class="word-group">
                            <div class="romanization"><span class="voiced">bha</span> - <span class="voiced">ga</span> - <span class="voiced">va</span> - <span class="voiced-pronunciation">te</span></div>
                            <div class="chinese">世尊</div>
                        </div>
                    </div>
                    
                    <div class="mantra-section">
                        <div class="word-group">
                            <div class="romanization"><span class="voiced">bhai</span> - <span class="voiceless">ṣa</span> - <span class="voiced">jya</span> - <span class="voiced">gu</span> - <span class="voiced">ru</span></div>
                            <div class="chinese">藥師</div>
                        </div>
                        
                        <div class="word-group">
                            <div class="romanization"><span class="voiced">vai</span> - <span class="voiced">ḍū</span> - <span class="voiced">rya</span></div>
                            <div class="chinese">琉璃</div>
                        </div>
                        
                        <div class="word-group">
                            <div class="romanization"><span class="voiceless">pra</span> - <span class="voiced">bhā</span></div>
                            <div class="chinese">光</div>
                        </div>
                        
                        <div class="word-group">
                            <div class="romanization"><span class="voiced">rā</span> - <span class="voiced">jā</span> - <span class="voiced">ya</span></div>
                            <div class="chinese">王</div>
                        </div>
                    </div>
                    
                    <div class="mantra-section">
                        <div class="word-group">
                            <div class="romanization"><span class="voiced-pronunciation">ta</span> - <span class="voiceless">thā</span> - <span class="voiced">ga</span> - <span class="voiced-pronunciation">tā</span> - <span class="voiced">ya</span></div>
                            <div class="chinese">如來</div>
                        </div>
                        
                        <div class="word-group">
                            <div class="romanization"><span class="voiced">ar</span> - <span class="voiceless">ha</span> - <span class="voiced-pronunciation">te</span></div>
                            <div class="chinese">應供</div>
                        </div>
                        
                        <div class="word-group">
                            <div class="romanization"><span class="voiceless">sam</span> - <span class="voiced">yak</span> - <span class="voiceless">saṃ</span> - <span class="voiced">bu</span> - <span class="voiced">ddhā</span> - <span class="voiced">ya</span></div>
                            <div class="chinese">正等覺</div>
                        </div>

                        

                    </div>
                    <div class="mantra-section">
                        <div class="word-group">
                            <div class="romanization"><span class="voiced-pronunciation">tad</span> - <span class="voiced">ya</span> - <span class="voiceless">thā</span></div>
                            <div class="chinese">即說咒曰：</div>
                        </div>
                    </div>
                    
                    <div class="separator"></div>
                    
                    <div class="mantra-section">
                        
                        <div class="word-group">
                            <div class="romanization"><span class="voiced">oṃ</span></div>
                            <div class="chinese">嗡！</div>
                        </div>
                        
                        <div class="word-group">
                            <div class="romanization"><span class="voiced">bhai</span> - <span class="voiceless">ṣa</span> - <span class="voiced">jye</span></div>
                            <div class="chinese">藥！</div>
                        </div>
                        
                        <div class="word-group">
                            <div class="romanization"><span class="voiced">bhai</span> - <span class="voiceless">ṣa</span> - <span class="voiced">jye</span></div>
                            <div class="chinese">藥！</div>
                        </div>
                    </div>
                    
                    <div class="mantra-section">
                        <div class="word-group">
                            <div class="romanization"><span class="voiced">bhai</span> - <span class="voiceless">ṣa</span> - <span class="voiced">jya</span></div>
                            <div class="chinese">藥</div>
                        </div>
                        
                        <div class="word-group">
                            <div class="romanization"><span class="voiceless">sa</span> - <span class="voiced">mud</span> - <span class="voiced">ga</span> - <span class="voiced-pronunciation">te</span></div>
                            <div class="chinese">生起來！</div>
                        </div>
                        
                        <div class="word-group">
                            <div class="romanization"><span class="voiceless">svā</span> - <span class="voiceless">hā</span></div>
                            <div class="chinese">成就！</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let player;
        let isPlaying = false;
        let currentTime = 0;
        let timeUpdateInterval;

        let playerReady = false;
        
        // 可用的播放速度選項
        const speedOptions = [0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2];
        let currentSpeedIndex = 3; // 預設 1x 速度
        
        // YouTube IFrame API 準備就緒時調用
        function onYouTubeIframeAPIReady() {
            console.log('YouTube API 正在初始化...');
            player = new YT.Player('youtubePlayer', {
                height: '100%',
                width: '100%',
                videoId: 'oayy63pHCAA',
                playerVars: {
                    'enablejsapi': 1,
                    'rel': 0,
                    'modestbranding': 1,
                    'controls': 0,
                    'disablekb': 1,
                    'playsinline': 1,
                    'iv_load_policy': 3,
                    'fs': 0,
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError
                }
            });
        }
        
        function onPlayerReady(event) {
            console.log('YouTube Player 已準備就緒');
            playerReady = true;
            startTimeUpdate();
            
            // 初始化時間顯示
            updateTimeDisplay();
        }
        
        function onPlayerStateChange(event) {
            console.log('播放器狀態變化:', event.data);
            
            if (event.data == YT.PlayerState.PLAYING) {
                isPlaying = true;
                updatePlayPauseButton();
                console.log('開始播放');
            } else if (event.data == YT.PlayerState.PAUSED) {
                isPlaying = false;
                updatePlayPauseButton();
                console.log('暫停播放');
            } else if (event.data == YT.PlayerState.ENDED) {
                isPlaying = false;
                updatePlayPauseButton();
                console.log('播放結束');
            }
        }
        
        function onPlayerError(event) {
            console.error('YouTube Player 錯誤:', event.data);
        }
        
        function togglePlayPause() {
            if (!playerReady || !player) {
                console.log('播放器尚未準備就緒');
                return;
            }
            
            try {
                if (isPlaying) {
                    player.pauseVideo();
                    console.log('執行暫停');
                } else {
                    player.playVideo();
                    console.log('執行播放');
                }
            } catch (error) {
                console.error('播放/暫停操作失敗:', error);
            }
        }
        
        function updatePlayPauseButton() {
            // 更新手機版按鈕
            const playIcon = document.getElementById('playIcon');
            const pauseIcon = document.getElementById('pauseIcon');
            
            // 更新桌機版按鈕
            const playIconDesktop = document.getElementById('playIconDesktop');
            const pauseIconDesktop = document.getElementById('pauseIconDesktop');
            
            if (playIcon && pauseIcon) {
                if (isPlaying) {
                    playIcon.style.display = 'none';
                    pauseIcon.style.display = 'block';
                } else {
                    playIcon.style.display = 'block';
                    pauseIcon.style.display = 'none';
                }
            }
            
            if (playIconDesktop && pauseIconDesktop) {
                if (isPlaying) {
                    playIconDesktop.style.display = 'none';
                    pauseIconDesktop.style.display = 'block';
                } else {
                    playIconDesktop.style.display = 'block';
                    pauseIconDesktop.style.display = 'none';
                }
            }
        }
        
        function seekRelative(seconds) {
            if (!playerReady || !player) {
                console.log('播放器尚未準備就緒，無法跳轉');
                return;
            }
            
            try {
                const currentTime = player.getCurrentTime();
                const newTime = Math.max(0, currentTime + seconds);
                player.seekTo(newTime, true);
                console.log(`跳轉到: ${newTime.toFixed(1)}秒 (${seconds > 0 ? '+' : ''}${seconds}秒)`);
            } catch (error) {
                console.error('跳轉失敗:', error);
            }
        }
        
        function resetAndPlay() {
            if (!playerReady || !player) {
                console.log('播放器尚未準備就緒，無法重置');
                return;
            }
            
            try {
                player.seekTo(0, true);
                player.playVideo();
                console.log('重置並開始播放');
            } catch (error) {
                console.error('重置播放失敗:', error);
            }
        }
        
        function changePlaybackRate() {
            if (!playerReady || !player) {
                console.log('播放器尚未準備就緒，無法改變速度');
                return;
            }
            
            const selects = document.querySelectorAll('.speed-select');
            let rate = 1;
            
            selects.forEach(select => {
                if (document.activeElement === select) {
                    rate = parseFloat(select.value);
                    currentSpeedIndex = speedOptions.indexOf(rate);
                    
                    // 同步其他選擇器
                    selects.forEach(otherSelect => {
                        if (otherSelect !== select) {
                            otherSelect.value = select.value;
                        }
                    });
                }
            });
            
            try {
                player.setPlaybackRate(rate);
                console.log('播放速度已設為:', rate + 'x');
            } catch (error) {
                console.error('設定播放速度失敗:', error);
            }
        }
        
        function adjustSpeed(direction) {
            if (!playerReady || !player) return;
            
            if (direction === 'up' && currentSpeedIndex < speedOptions.length - 1) {
                currentSpeedIndex++;
            } else if (direction === 'down' && currentSpeedIndex > 0) {
                currentSpeedIndex--;
            } else {
                return;
            }
            
            const newSpeed = speedOptions[currentSpeedIndex];
            
            try {
                player.setPlaybackRate(newSpeed);
                
                const selects = document.querySelectorAll('.speed-select');
                selects.forEach(select => {
                    select.value = newSpeed;
                });
                
                console.log(`速度調整至: ${newSpeed}x`);
                showSpeedNotification(newSpeed);
                
            } catch (error) {
                console.error('設定播放速度失敗:', error);
            }
        }
        
        function showSpeedNotification(speed) {
            let notification = document.getElementById('speedNotification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'speedNotification';
                notification.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 8px;
                    font-size: 18px;
                    font-weight: 600;
                    z-index: 1000;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                    pointer-events: none;
                `;
                document.body.appendChild(notification);
            }
            
            notification.textContent = `播放速度: ${speed}x`;
            notification.style.opacity = '1';
            
            setTimeout(() => {
                notification.style.opacity = '0';
            }, 1000);
        }
        
        function startTimeUpdate() {
            if (timeUpdateInterval) {
                clearInterval(timeUpdateInterval);
            }
            
            timeUpdateInterval = setInterval(() => {
                if (playerReady && player && typeof player.getCurrentTime === 'function') {
                    try {
                        currentTime = player.getCurrentTime();
                        updateTimeDisplay();
                    } catch (error) {
                        // 靜默處理錯誤
                    }
                }
            }, 500); // 減少更新間隔到500ms以獲得更精確的時間顯示
        }
        
        function updateTimeDisplay() {
            const timeElement = document.getElementById('currentTime');
            const timeElementDesktop = document.getElementById('currentTimeDesktop');
            const minutes = Math.floor(currentTime / 60);
            const seconds = Math.floor(currentTime % 60);
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeElement) {
                timeElement.textContent = timeString;
            }
            
            if (timeElementDesktop) {
                timeElementDesktop.textContent = timeString;
            }
        }
        

        
        // 鍵盤快捷鍵支援
        document.addEventListener('keydown', function(event) {
            if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA' || event.target.tagName === 'SELECT') {
                return;
            }
            
            switch(event.code) {
                case 'Space':
                    event.preventDefault();
                    togglePlayPause();
                    break;
                case 'KeyR':
                    event.preventDefault();
                    resetAndPlay();
                    break;
                case 'ArrowLeft':
                case 'BracketLeft':
                    event.preventDefault();
                    seekRelative(-2);
                    break;
                case 'ArrowRight':
                case 'BracketRight':
                    event.preventDefault();
                    seekRelative(2);
                    break;
                case 'Minus':
                case 'NumpadSubtract':
                    if (!event.metaKey) {
                        event.preventDefault();
                        adjustSpeed('down');
                    }
                    break;
                case 'Equal':
                case 'NumpadAdd':
                    if (!event.metaKey) {
                        event.preventDefault();
                        adjustSpeed('up');
                    }
                    break;
                case 'Digit0':
                case 'Numpad0':
                    if (!event.metaKey) {
                        event.preventDefault();
                        currentSpeedIndex = 3;
                        const normalSpeed = speedOptions[currentSpeedIndex];
                        if (playerReady && player) {
                            player.setPlaybackRate(normalSpeed);
                            const selects = document.querySelectorAll('.speed-select');
                            selects.forEach(select => {
                                select.value = normalSpeed;
                            });
                            showSpeedNotification(normalSpeed);
                            console.log('速度重設為正常: 1x');
                        }
                    }
                    break;
            }
        });
        
        // 頁面載入完成後的初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('頁面已載入，等待 YouTube API...');
            console.log('控制欄模式：統一固定在底部');
            
            // 確保 YouTube API 腳本已載入
            if (!window.YT) {
                console.log('正在等待 YouTube API 載入...');
            }
        });
        
        // 清理函數
        window.addEventListener('beforeunload', function() {
            if (timeUpdateInterval) {
                clearInterval(timeUpdateInterval);
            }
        });
    </script>
</body>
</html>